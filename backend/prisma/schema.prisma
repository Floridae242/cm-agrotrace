datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id           String   @id @default(uuid()) @db.Char(36)
  email        String   @unique
  name         String?
  passwordHash String
  role         String   @default("FARMER")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // ฝั่งตรงข้าม relation
  ownerLots    Lot[]    @relation("OwnerLots")
}

enum Role {
  FARMER
  PACKHOUSE
  BUYER
  INSPECTOR
  ADMIN
}

model Lot {
  id            String   @id @default(cuid())
  lotId         String   @unique
  cropType      String
  variety       String?
  farmName      String?
  province      String?
  district      String?
  harvestDate   DateTime
  brix          Float?
  moisture      Float?
  pesticidePass Boolean?
  notes         String?
  owner         User     @relation("OwnerLots", fields: [ownerId], references: [id])
  ownerId       String
  events        Event[]
  hash          String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Event {
  id           String    @id @default(cuid())
  lot          Lot       @relation(fields: [lotId], references: [id])
  lotId        String
  type         EventType
  timestamp    DateTime  @default(now())
  locationName String?
  fromName     String?
  toName       String?
  temperature  Float?
  humidity     Float?
  note         String?
}

enum EventType {
  HARVEST_CREATED
  SENSOR_READING
  TRANSPORTED
  INSPECTED
  MERGED
  SOLD
}
